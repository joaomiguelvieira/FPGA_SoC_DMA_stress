clearvars;
close all;

raw_data = [4	1600	1.6997	1.672	1.7356	0.0082
8	1600	3.3987	3.2932	3.4211	0.017
16	1600	6.7978	6.6158	6.8421	0.0329
32	1600	13.5965	13.3934	13.6842	0.0625
64	1600	27.1922	26.6838	27.3684	0.1265
128	1600	50.8812	47.8711	51.3263	0.3831
256	1600	101.5225	95.6872	102.4	1.4736
512	1600	182.2729	181.7586	191.2644	1.3168
1024	1600	329.0341	326.1146	334.9774	0.4697
2048	1600	551.388	542.0195	551.9071	0.707
4096	1600	832.36	808.9942	833.824	5.7037
8192	1600	1076.1281	1072.2513	1076.152	0.2816
16384	1600	1288.8095	1284.0125	1289.6101	0.3445
32768	1600	1430.1331	1427.0821	1430.1484	0.2163
65536	1600	1512.6376	1507.8546	1513.1034	1.4605
131072	1600	1552.7713	1552.7593	1554.9983	0.1582
262144	1600	1576.2129	1575.676	1576.2882	0.0384
524288	1600	1588.2015	1587.486	1588.211	0.075
1048576	1600	1594.106	1593.9122	1594.2776	0.1809
2097152	1600	1596.9658	1596.9634	1597.1412	0.0191
4194304	1600	1598.4907	1598.47	1598.5468	0.0044
8388608	1600	1599.257	1599.2393	1599.2595	0.0013
16777216	1600	1599.6401	1599.6179	1599.6419	0.0039
33554432	1600	1599.8099	1599.8096	1599.8208	0.001];

stream_size = raw_data(:,1)';
expected = raw_data(:,2)';
average = raw_data(:,3)';
minimum = raw_data(:,4)';
maximum = raw_data(:,5)';
deviation = raw_data(:,6)';
efficiency = average ./ expected;

figure('Position', [699, 259, 1000, 200]);
plot(log2(stream_size), average, '-x');
hold on;
plot(log2(stream_size), 1600 * ones(24), '--');
grid on;
xlim([min(log2(stream_size)), max(log2(stream_size))]);
ylim([0, 1.1 * max(average)]);
xticks(log2(stream_size));
xticklabels({'2^2','2^3','2^4','2^5','2^6','2^7','2^8','2^9','2^{10}','2^{11}','2^{12}','2^{13}','2^{14}','2^{15}','2^{16}','2^{17}','2^{18}','2^{19}','2^{20}','2^{21}','2^{22}','2^{23}','2^{24}','2^{25}',});
ylabel("Bandwidth [MB/s]");
xlabel("Stream size [B]");
legend("Observed bandwidth", "Expected bandwidth", "Location", "southeast", "Orientation", "Horizontal");
saveas(gcf,'var_stream_size','epsc');